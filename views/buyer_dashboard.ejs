<!DOCTYPE html>
<html>
<head>
    <title>Buyer Dashboard</title>
</head>
<body>
    <h1>Welcome, <%= username %>!</h1>
    <a href="/logout">Logout</a>

    <hr>

    <h2>Search & Filter Products</h2>
    <form method="get" action="/buyer_dashboard">
        <input type="text" name="search" placeholder="Search by code or name" value="<%= searchQuery %>">
        
        <select name="category">
            <option value="all" <%= selectedCategory === 'all' ? 'selected' : '' %>>All Categories</option>
            <% categories.forEach(cat => { %>
                <option value="<%= cat.productGroup %>" <%= selectedCategory === cat.productGroup ? 'selected' : '' %>>
                    <%= cat.productGroup %>
                </option>
            <% }) %>
        </select>
        <button type="submit">Search</button>
    </form>

    <hr>

    <h2>Products</h2>
    <% if (products.length === 0) { %>
        <p>No products found.</p>
    <% } else { %>
        <table border="1" cellpadding="5">
            <thead>
                <tr>
                    <th>Code</th>
                    <th>Name</th>
                    <th>Category</th>
                    <th>Trade Price</th>
                    <th>RRP Price</th>
                    <th>Image</th>
                </tr>
            </thead>
            <tbody>
                <% products.forEach(product => { %>
                    <tr>
                        <td><%= product.code %></td>
                        <td><%= product.name %></td>
                        <td><%= product.productGroup %></td>
                        <td><%= product.tradePrice %></td>
                        <td><%= product.rrpPrice %></td>
                        <td>
                            <% if (product.image) { %>
                                <img src="/uploads/<%= product.image %>" width="80" alt="<%= product.name %>">
                            <% } else { %>
                                N/A
                            <% } %>
                        </td>
                    </tr>
                <% }) %>
            </tbody>
        </table>
    <% } %>
</body>
</html>
